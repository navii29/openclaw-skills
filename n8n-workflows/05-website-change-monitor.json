{
  "name": "ðŸŒ Website Change Monitor",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300],
      "name": "Every 6 Hours"
    },
    {
      "parameters": {
        "jsCode": "// Liste der zu Ã¼berwachenden Websites\nconst websites = [\n  { name: 'Competitor A', url: 'https://competitor-a.com/pricing' },\n  { name: 'Competitor B', url: 'https://competitor-b.com/features' },\n  { name: 'Industry News', url: 'https://techcrunch.com/category/ai/' }\n];\n\nreturn websites.map(site => ({\n  json: site\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300],
      "name": "Website List"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [650, 300],
      "name": "Fetch Website"
    },
    {
      "parameters": {
        "jsCode": "const crypto = require('crypto');\nconst site = $input.first().json;\nconst content = $input.all()[1]?.json?.data || '';\n\n// Create hash of content\nconst hash = crypto.createHash('md5').update(content).digest('hex');\n\nreturn [{\n  json: {\n    name: site.name,\n    url: site.url,\n    hash: hash,\n    contentPreview: content.substring(0, 500),\n    checkedAt: new Date().toISOString()\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300],
      "name": "Calculate Hash"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "Website Monitor",
        "id": "={{ $json.url }}"
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [1050, 300],
      "name": "Get Last Hash",
      "credentials": {
        "notionApi": {
          "id": "YOUR_NOTION_CREDENTIAL_ID",
          "name": "Notion API"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "hash-changed",
              "leftValue": "={{ $('Calculate Hash').item.json.hash }}",
              "rightValue": "={{ $json.properties?.Hash?.rich_text?.[0]?.plain_text }}",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1250, 300],
      "name": "Content Changed?"
    },
    {
      "parameters": {
        "channel": "#monitoring",
        "text": "ðŸ”” *Website Changed*\n\n*{{ $('Calculate Hash').item.json.name }}*\nURL: {{ $('Calculate Hash').item.json.url }}\nChanged at: {{ $('Calculate Hash').item.json.checkedAt }}",
        "blocksUi": {
          "blocks": [
            {
              "type": "actions",
              "elements": [
                {
                  "type": "button",
                  "text": {
                    "type": "plain_text",
                    "text": "View Changes"
                  },
                  "url": "={{ $('Calculate Hash').item.json.url }}"
                }
              ]
            }
          ]
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2,
      "position": [1450, 200],
      "name": "Notify Change",
      "credentials": {
        "slackApi": {
          "id": "YOUR_SLACK_CREDENTIAL_ID",
          "name": "Slack API"
        }
      }
    },
    {
      "parameters": {
        "tableId": "Website Monitor",
        "fieldsUi": {
          "fieldValues": [
            { "fieldId": "Name", "fieldValue": "={{ $('Calculate Hash').item.json.name }}" },
            { "fieldId": "URL", "fieldValue": "={{ $('Calculate Hash').item.json.url }}" },
            { "fieldId": "Hash", "fieldValue": "={{ $('Calculate Hash').item.json.hash }}" },
            { "fieldId": "Last Checked", "fieldValue": "={{ $('Calculate Hash').item.json.checkedAt }}" }
          ]
        }
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [1650, 300],
      "name": "Update Database",
      "credentials": {
        "notionApi": {
          "id": "YOUR_NOTION_CREDENTIAL_ID",
          "name": "Notion API"
        }
      }
    }
  ],
  "connections": {
    "Every 6 Hours": {
      "main": [
        [
          {
            "node": "Website List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Website List": {
      "main": [
        [
          {
            "node": "Fetch Website",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Website": {
      "main": [
        [
          {
            "node": "Calculate Hash",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Hash": {
      "main": [
        [
          {
            "node": "Get Last Hash",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Last Hash": {
      "main": [
        [
          {
            "node": "Content Changed?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Content Changed?": {
      "main": [
        [
          {
            "node": "Notify Change",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notify Change": {
      "main": [
        [
          {
            "node": "Update Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [
    {
      "name": "Monitoring",
      "id": "tag-monitoring"
    }
  ]
}
